<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta charset="utf-8">
  

  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
  <link rel="preconnect" href="https://fastly.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="//unpkg.com">

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  <title>改变世界的编程语言MoonBit：配置系统介绍(下) - RSSBOX</title>

  
    <meta name="description" content="改变世界的编程语言 MoonBit  大家好，我是农村程序员，独立开发者，前端之虎陈随易，我的个人网站是 https:&#x2F;&#x2F;chensuiyi.me   这是我的 《改变世界的编程语言MoonBit》 系列文章，将自己学习和理解 MoonBit 的过程分享给大家，希望能带来参考和帮助。   全部文章可以前往 MoonBit 开发网 https:&#x2F;&#x2F;moonbit.edgeone.app 或 htt">
<meta property="og:type" content="article">
<meta property="og:title" content="改变世界的编程语言MoonBit：配置系统介绍(下)">
<meta property="og:url" content="https://rssbox.mhuig.top/rss/cb218f94.html">
<meta property="og:site_name" content="RSSBOX">
<meta property="og:description" content="改变世界的编程语言 MoonBit  大家好，我是农村程序员，独立开发者，前端之虎陈随易，我的个人网站是 https:&#x2F;&#x2F;chensuiyi.me   这是我的 《改变世界的编程语言MoonBit》 系列文章，将自己学习和理解 MoonBit 的过程分享给大家，希望能带来参考和帮助。   全部文章可以前往 MoonBit 开发网 https:&#x2F;&#x2F;moonbit.edgeone.app 或 htt">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-31T15:12:45.000Z">
<meta property="article:modified_time" content="2025-10-31T15:12:45.000Z">
<meta property="article:author" content="MHuiG">
<meta property="article:tag" content="媒体">
<meta property="article:tag" content="掘金">
<meta name="twitter:card" content="summary_large_image">
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="RSSBOX" type="application/atom+xml">
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  

  

  


  
</head>

<body>
  




  <div class="l_body" id="start">
    <aside class="l_left" layout="post">
    


<header class="header">

<div class="logo-wrap"><a class="avatar" target="_blank" rel="noopener" href="https://mhuig.top/"><div class="bg" style="opacity:0;background-image:url(https://static.mhuig.top/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/avatar.png" onerror="javascript:this.classList.add('error');this.src='https://static.mhuig.top/gh/cdn-x/placeholder@1.0.1/image/2659360.svg';"></a><a class="title" href="/"><div class="main">RSSBOX</div><div class="sub normal cap">MHuiGのRSS订阅</div><div class="sub hover cap" style="opacity:0">rssbox.mhuig.top</div></a></div>
<nav class="menu dis-select"><a class="nav-item active" href="/">RSS</a><a class="nav-item" target="_blank" rel="noopener" href="https://blog.mhuig.top/">博客</a><a class="nav-item" target="_blank" rel="noopener" href="https://mhuig.top/">关于</a></nav></header>

<div class="widgets">

<div class="widget-wrap single" id="toc"><div class="widget-header cap dis-select"><span class="name">本文目录</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">改变世界的编程语言 MoonBit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">往期文章</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">MoonBit 包配置概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">完整配置示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">is-main 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">import 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">test-import 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">wbtest-import 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">link 配置说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">native 链接配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">js 链接配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">wasm 链接配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">wasm-gc 链接配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">多目标配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">native-stub 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">implement 和 overrides 配置说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">什么是虚拟包？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">implement 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">overrides 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">virtual 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">pre-build 配置说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">内置命令：:embed</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">targets 配置说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">基本条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">组合条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">条件编译对比表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">virtual 配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">warn-list 和 alert-list 配置说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">warn-list 简要回顾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">alert-list 简要回顾</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div>


</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/MHuiG" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://static.mhuig.top/gh/cdn-x/placeholder@1.0.3/social/08a41b181ce68.svg"></a><a class="social" href="https://music.163.com/#/user/home?id=63035382" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://static.mhuig.top/gh/cdn-x/placeholder@1.0.3/social/3845874.svg"></a><a class="social" href="/contact/" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://static.mhuig.top/gh/cdn-x/placeholder@1.0.3/social/a1b00e20f425d.svg"></a></div></footer>

    </aside>
    <div class="l_main">
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%AA%92%E4%BD%93/">媒体</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/categories/%E5%AA%92%E4%BD%93/%E6%8E%98%E9%87%91/">掘金</a></div><div id="post-meta">发布于&nbsp;<time datetime="2025-10-31T15:12:45.000Z">2025-10-31</time></div></div>

<article class="content md post">
<h1 class="article-title"><span>改变世界的编程语言MoonBit：配置系统介绍(下)</span></h1>
<div>
<h2 data-id="heading-0">改变世界的编程语言 MoonBit</h2>
<blockquote>
<p>大家好，我是农村程序员，独立开发者，前端之虎陈随易，我的个人网站是 <code>https://chensuiyi.me</code></p>
</blockquote>
<blockquote>
<p>这是我的 <code>《改变世界的编程语言MoonBit》</code> 系列文章，将自己学习和理解 MoonBit 的过程分享给大家，希望能带来参考和帮助。</p>
</blockquote>
<blockquote>
<p>全部文章可以前往 MoonBit 开发网 <code>https://moonbit.edgeone.app</code> 或 <code>https://moonbit.pages.dev</code> 查看，我坚信，MoonBit 将会改变世界。</p>
</blockquote>
<h3 data-id="heading-1">往期文章</h3>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFPDr9JzFoGp806pzSDRe-g" ref="nofollow noopener noreferrer" target="_blank" title="https://mp.weixin.qq.com/s/FPDr9JzFoGp806pzSDRe-g" rel="external nofollow noopener noreferrer">改变世界的编程语言 MoonBit：背景知识速览</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTr7-XOI20OMU5YZ0v7e-Mg" ref="nofollow noopener noreferrer" target="_blank" title="https://mp.weixin.qq.com/s/Tr7-XOI20OMU5YZ0v7e-Mg" rel="external nofollow noopener noreferrer">改变世界的编程语言 MoonBit：项目文件详解</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDZBJMFutT8um9FX2SxBNHg" ref="nofollow noopener noreferrer" target="_blank" title="https://mp.weixin.qq.com/s/DZBJMFutT8um9FX2SxBNHg" rel="external nofollow noopener noreferrer">改变世界的编程语言 MoonBit：配置系统介绍(上)</a></li>
</ul>
<p>上篇文章，主要对 MoonBit 的<code>moon.mod.json(模块配置)</code>进行了详细讲解，本文则对<code>moon.pkg.json(包配置)</code>进行介绍和讲解。</p>
<h3 data-id="heading-2">MoonBit 包配置概述</h3>
<p>按照 MoonBit 的约定，一个目录下如果有 <code>moon.pkg.json</code> 文件，那么这个目录就是一个<code>包(Package)</code>。</p>
<p>如果说<code>模块(Module)</code>是一个项目的整体配置，那么<code>包(Package)</code>就是项目中某个具体功能单元的配置。一个模块可以包含多个包，每个包负责不同的功能。</p>
<p><strong>类比理解</strong>：模块就像一本书，而包就是书中的各个章节。每个章节有自己的内容和特点，但都属于同一本书。</p>
<h3 data-id="heading-3">完整配置示例</h3>
<p>MoonBit 完整的<code>包配置参数(moon.pkg.json)</code>如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"is-main"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"moonbitlang/quickcheck"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/encoding"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lib"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"encode"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"wbtest-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/usr/bin/gcc13"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-DMOONBIT"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-s"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hello"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esm"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"export-memory-name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"import-memory"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
                <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"env"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span>
            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hello"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"foo:bar"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm-gc"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hello"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"foo:bar"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"use-js-builtin-string"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"imported-string-constants"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"native-stub"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"file1.c"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"file2.c"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/abort"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"moonbitlang/dummy_abort/abort_show_msg"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"only_js.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_wasm_gc.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"all_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"not_js.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"not"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_debug.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"js_and_release.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"js_or_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm_release_or_js_debug.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"or"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"js"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"virtual"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"has-default"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"warn-list"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-2-4+31"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"alert-list"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-test_import_all+deprecated-warn"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>下面我们逐个详细讲解每个配置项。</p>
<h3 data-id="heading-4">is-main 配置说明</h3>
<p><code>is-main</code> 用来标识这个包是否是程序的<code>入口包</code>，就像一本书的第一章，是读者开始阅读的地方。</p>
<p><strong>配置值</strong>：</p>
<ul>
<li><code>true</code>：表示这是主包，包含程序的入口点（<code>main</code> 函数）</li>
<li><code>false</code>：表示这是普通包，提供功能但不是程序入口</li>
</ul>
<p><strong>通俗理解</strong>：</p>
<p>在一个应用程序中，必须有一个起点，告诉计算机"从这里开始执行"。<code>is-main: true</code> 就是在说："嘿，我就是那个起点！"</p>
<p><strong>典型使用场景</strong>：</p>
<p><strong>场景一：命令行工具</strong></p>
<p>你开发了一个命令行工具，需要一个入口来接收用户的命令和参数。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"is-main"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"moonbitlang/core/builtin"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>配套的 <code>main.mbt</code> 文件：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main &#123;
  println("Hello, MoonBit!")
&#125;
</code></pre>
<p><strong>场景二：库包</strong></p>
<p>你开发了一个工具库，提供各种实用函数，但它本身不需要运行。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"is-main"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>这个包提供的函数将被其他包导入使用。</p>
<p><strong>注意事项</strong>：</p>
<p>⚠️ 根据实测，<strong>一个模块中可以有多个 <code>is-main: true</code> 的包</strong>，可以生成多个可执行文件。</p>
<p>⚠️ 如果设置了 <code>is-main: true</code>，那么包中必须有 <code>main</code> 函数，否则会报错。</p>
<h3 data-id="heading-5">import 配置说明</h3>
<p><code>import</code> 就是告诉 MoonBit："我需要使用其他包的功能"。就像做菜时，你需要的各种调料和食材。</p>
<p><strong>配置方式</strong>：</p>
<p><strong>方式一：简单导入</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"moonbitlang/core/builtin"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"moonbitlang/quickcheck"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>直接列出需要导入的包的完整路径。</p>
<p><strong>方式二：带别名导入</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/encoding"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"enc"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>给导入的包起个简短的别名，使用时更方便。</p>
<p><strong>方式三：选择性导入</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/encoding"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lib"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"encode"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"decode"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>只导入包中的特定功能，而不是全部。</p>
<p><strong>在代码中使用</strong>：</p>
<p>导入后，在代码中通过 <code>@别名</code> 或 <code>@包名</code> 来使用：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 使用简单导入的包
let result = @quickcheck.run(test)

<p>&#x2F;&#x2F; 使用别名导入的包<br>let encoded &#x3D; @enc.encode(data)</p>
<p>&#x2F;&#x2F; 使用选择性导入<br>let value &#x3D; @lib.encode(“hello”)<br></p></code></pre><p></p>
<p><strong>实际应用场景</strong>：</p>
<p><strong>场景一：开发 Web 应用</strong></p>
<p>需要 HTTP 客户端、JSON 处理等功能：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/http"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/json"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"json"</span> <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>场景二：数据处理工具</strong></p>
<p>只需要特定的编解码功能：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/encoding"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"encoding"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"base64_encode"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"base64_decode"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>依赖关系</strong>：</p>
<table><thead><tr><th>配置位置</th><th>配置内容</th><th>作用</th></tr></thead><tbody><tr><td>moon.mod.json</td><td><code>deps</code></td><td>声明模块级别的依赖（需要谁）</td></tr><tr><td>moon.pkg.json</td><td><code>import</code></td><td>在包中实际使用依赖（用了谁）</td></tr><tr><td>关系</td><td>deps 是前提条件</td><td>import 是具体使用</td></tr><tr><td>类比</td><td>买菜（准备食材）</td><td>做菜（使用食材）</td></tr><tr><td>必要性</td><td>必须先在 deps 声明</td><td>才能在 import 使用</td></tr></tbody></table>
<p><strong>重要提示</strong>：</p>
<p>✅ 使用 <code>moon add &lt;包名&gt;</code> 命令会自动更新 <code>moon.mod.json</code> 的 <code>deps</code></p>
<p>✅ 然后需要手动在 <code>moon.pkg.json</code> 的 <code>import</code> 中添加要使用的包</p>
<p>✅ 别名可以避免包名过长，提高代码可读性</p>
<h3 data-id="heading-6">test-import 配置说明</h3>
<p><code>test-import</code> 是专门用于<code>黑盒测试</code>的导入配置。就像质检员从外部检查产品质量，不关心内部实现。</p>
<p><strong>什么是黑盒测试？</strong></p>
<p>黑盒测试只能测试包的<strong>公开接口</strong>（<code>pub</code> 标记的函数、类型等），不能访问包的内部实现细节。就像用户使用软件，只能看到界面和功能，看不到背后的代码。</p>
<p><strong>配置方式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"test-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"moonbitlang/quickcheck"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p>在测试文件（<code>_test.mbt</code> 结尾）中编写测试：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// math_test.mbt - 黑盒测试
test "add function" &#123;
  let result = @math.add(1, 2)  // 只能使用 pub 函数
  @test.assert_eq(result, 3)
&#125;
</code></pre>
<p><strong>实际应用场景</strong>：</p>
<p><strong>场景一：测试 API 接口</strong></p>
<p>测试一个 HTTP 客户端库的公开 API：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"test-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/http"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http"</span> <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">test "http get request" &#123;
  let response = @http.get("https://api.example.com")
  @test.assert_true(response.status == 200)
&#125;
</code></pre>
<p><strong>场景二：测试工具函数库</strong></p>
<p>测试字符串处理库的公开函数：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"test-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"username/stringutils"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"str"</span> <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">test "capitalize function" &#123;
  let result = @str.capitalize("hello")
  @test.assert_eq(result, "Hello")
&#125;
</code></pre>
<p><strong>测试类型对比</strong>：</p>
<table><thead><tr><th>对比项</th><th>test-import（黑盒测试）</th><th>wbtest-import（白盒测试）</th></tr></thead><tbody><tr><td>访问权限</td><td>只能测试 <code>pub</code> 公开内容</td><td>可以测试包内所有内容</td></tr><tr><td>测试角度</td><td>外部用户视角</td><td>开发者视角</td></tr><tr><td>文件命名</td><td><code>*_test.mbt</code></td><td><code>*_wbtest.mbt</code></td></tr><tr><td>适用场景</td><td>API 接口测试、用户功能验收测试</td><td>内部函数测试、边界条件详细测试</td></tr><tr><td>类比</td><td>用户试用产品</td><td>工程师检查零件</td></tr></tbody></table>
<p><strong>注意事项</strong>：</p>
<p>⚠️ 黑盒测试文件通常放在单独的测试目录中</p>
<p>⚠️ 测试导入的包不会被打包到最终的程序中，只用于开发阶段</p>
<p>⚠️ 推荐使用测试框架（如 <code>moonbitlang/core/test</code>）来组织测试用例</p>
<h3 data-id="heading-7">wbtest-import 配置说明</h3>
<p><code>wbtest-import</code> 是专门用于<code>白盒测试</code>的导入配置。就像工程师打开机器检查内部零件，可以看到和测试所有细节。</p>
<p><strong>什么是白盒测试？</strong></p>
<p>白盒测试可以访问包的<strong>所有内容</strong>，包括私有函数、内部变量等。这让开发者能够深入测试每个细节，确保内部逻辑正确。</p>
<p><strong>配置方式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"wbtest-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"moonbitlang/x/debug"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p>在白盒测试文件（<code>_wbtest.mbt</code> 结尾）中编写测试：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// math_wbtest.mbt - 白盒测试
test "internal helper function" &#123;
  // 可以测试私有函数
  let result = internal_calculate(5, 3)
  @test.assert_eq(result, 8)
&#125;
</code></pre>
<p><strong>实际应用场景</strong>：</p>
<p><strong>场景一：测试算法实现</strong></p>
<p>测试一个排序算法的内部辅助函数：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"wbtest-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// sort_wbtest.mbt
test "partition function" &#123;
  // partition 是内部函数，黑盒测试无法访问
  let arr = [3, 1, 4, 1, 5]
  let pivot_index = partition(arr, 0, 4)
  @test.assert_true(pivot_index &gt;= 0 &amp;&amp; pivot_index &lt;= 4)
&#125;
</code></pre>
<p><strong>场景二：测试边界条件</strong></p>
<p>深入测试内部状态管理：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"wbtest-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/test"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test"</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/x/debug"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"debug"</span> <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// cache_wbtest.mbt
test "cache internal state" &#123;
  let cache = new_cache()
  // 测试内部的缓存状态
  @test.assert_eq(cache.size, 0)
  @test.assert_eq(cache.capacity, 100)

<p>  &#x2F;&#x2F; 使用调试工具检查内部结构<br>  @debug.inspect(cache)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景三：测试错误处理</strong></p>
<p>测试内部错误处理逻辑：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// error_wbtest.mbt
test "internal error handling" &#123;
  // 直接调用内部错误处理函数
  let error = create_error("test", 404)
  @test.assert_eq(error.code, 404)
  @test.assert_eq(error.message, "test")
&#125;
</code></pre>
<p><strong>黑盒测试 vs 白盒测试</strong>：</p>
<table><thead><tr><th>特性</th><th>黑盒测试（test-import）</th><th>白盒测试（wbtest-import）</th></tr></thead><tbody><tr><td>测试对象</td><td>公开 API（<code>pub</code> 内容）</td><td>所有内容（包括私有）</td></tr><tr><td>测试目的</td><td>验证功能是否符合预期</td><td>验证实现细节和内部逻辑</td></tr><tr><td>测试者</td><td>可以是任何使用者</td><td>通常是开发者本人</td></tr><tr><td>测试深度</td><td>浅层（只看行为）</td><td>深层（看实现）</td></tr><tr><td>维护成本</td><td>低（API 变化少）</td><td>高（实现可能经常变）</td></tr><tr><td>文件名</td><td><code>*_test.mbt</code></td><td><code>*_wbtest.mbt</code></td></tr><tr><td>适用场景</td><td>用户验收、回归测试</td><td>单元测试、性能测试</td></tr><tr><td>类比</td><td>试驾汽车（只关心驾驶体验）</td><td>检查引擎（关心内部运作）</td></tr><tr><td>优点</td><td>测试稳定，不受内部实现影响</td><td>测试全面，覆盖所有代码路径</td></tr><tr><td>缺点</td><td>无法测试内部逻辑</td><td>维护成本高，实现变化需更新</td></tr><tr><td>推荐度</td><td>⭐⭐⭐⭐⭐（优先使用）</td><td>⭐⭐⭐（按需使用）</td></tr></tbody></table>
<p><strong>最佳实践</strong>：</p>
<ol>
<li><strong>优先编写黑盒测试</strong>：关注用户最关心的功能</li>
<li><strong>补充白盒测试</strong>：针对复杂逻辑和边界情况</li>
<li><strong>保持平衡</strong>：不要过度依赖白盒测试，避免测试和实现耦合太紧</li>
<li><strong>定期重构</strong>：当白盒测试频繁失败时，考虑重构实现或测试</li>
</ol>
<p><strong>测试策略建议</strong>：</p>
<pre><code class="hljs language-erlang" lang="erlang">总测试量 = <span class="hljs-number">70</span><span class="hljs-comment">% 黑盒测试 + 30% 白盒测试</span>

<p>黑盒测试：<br>  ✅ API 接口测试<br>  ✅ 用户场景测试<br>  ✅ 集成测试</p>
<p>白盒测试：<br>  ✅ 复杂算法内部逻辑<br>  ✅ 边界条件和异常处理<br>  ✅ 性能关键代码路径<br></p></code></pre><p></p>
<h3 data-id="heading-8">link 配置说明</h3>
<p><code>link</code> 配置用于指定不同编译目标的链接选项。就像给不同平台的用户准备不同的安装包。</p>
<p>MoonBit 支持多个编译目标：</p>
<ul>
<li><strong>native</strong>：编译为本地机器码（最快）</li>
<li><strong>js</strong>：编译为 JavaScript（用于浏览器和 Node.js）</li>
<li><strong>wasm</strong>：编译为 WebAssembly（跨平台，高性能）</li>
<li><strong>wasm-gc</strong>：带垃圾回收的 WebAssembly（更现代）</li>
</ul>
<h4 data-id="heading-9">native 链接配置</h4>
<p>用于配置编译为本地代码时的 C 编译器选项。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/usr/bin/gcc13"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-DMOONBIT -O2"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-lm -lpthread"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>配置项说明</strong>：</p>
<table><thead><tr><th>配置项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>cc</code></td><td>指定 C 编译器路径</td><td><code>"/usr/bin/gcc13"</code></td></tr><tr><td><code>cc-flags</code></td><td>C 编译器编译选项</td><td><code>"-O2 -g -DDEBUG"</code></td></tr><tr><td><code>cc-link-flags</code></td><td>C 链接器选项</td><td><code>"-lm -lpthread -static"</code></td></tr><tr><td><code>stub-cc</code></td><td>编译 stub 文件的编译器</td><td><code>"/usr/bin/clang"</code></td></tr></tbody></table>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：高性能计算工具</strong></p>
<p>需要调用 C 数学库，进行大量数值计算：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gcc"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-lm"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>场景二：系统工具开发</strong></p>
<p>需要特定的编译优化和静态链接：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/usr/bin/gcc"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-O3 -march=native"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-static"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<h4 data-id="heading-10">js 链接配置</h4>
<p>用于配置编译为 JavaScript 时的选项。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"add"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"multiply"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"calculate"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esm"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>配置项说明</strong>：</p>
<table><thead><tr><th>配置项</th><th>说明</th><th>可选值</th><th>示例</th></tr></thead><tbody><tr><td><code>exports</code></td><td>导出给 JS 调用的函数列表</td><td>函数名数组</td><td><code>["add", "subtract"]</code></td></tr><tr><td><code>format</code></td><td>JavaScript 模块格式</td><td><code>esm</code>, <code>cjs</code>, <code>iife</code></td><td><code>"esm"</code></td></tr></tbody></table>
<p><strong>模块格式说明</strong>：</p>
<table><thead><tr><th>格式</th><th>全称</th><th>适用场景</th><th>导入方式</th></tr></thead><tbody><tr><td><code>esm</code></td><td>ES Module（推荐）</td><td>现代浏览器、Deno、Node.js</td><td><code>import &#123; add &#125; from './math.js'</code></td></tr><tr><td><code>cjs</code></td><td>CommonJS</td><td>老版本 Node.js</td><td><code>const &#123; add &#125; = require('./math')</code></td></tr><tr><td><code>iife</code></td><td>Immediately Invoked Function Expression</td><td>直接在浏览器中使用</td><td><code>&lt;script src="math.js"&gt;&lt;/script&gt;</code></td></tr></tbody></table>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：开发 npm 包</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"encrypt"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"decrypt"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"hash"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esm"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>在 Node.js 中使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> &#123; encrypt, decrypt &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'my-crypto-lib'</span>;

<p><span class="hljs-keyword">const</span> encrypted &#x3D; <span class="hljs-title function_">encrypt</span>(<span class="hljs-string">‘secret message’</span>);<br><span class="hljs-keyword">const</span> decrypted &#x3D; <span class="hljs-title function_">decrypt</span>(encrypted);<br></p></code></pre><p></p>
<p><strong>场景二：浏览器计算库</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"calculate"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"analyze"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iife"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>在 HTML 中使用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"calculator.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">calculate</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">wasm 链接配置</h4>
<p>用于配置编译为传统 WebAssembly 时的选项。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"add"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"multiply:math_multiply"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"export-memory-name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"heap-start-address"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"import-memory"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
                <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"env"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span>
            <span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>配置项说明</strong>：</p>
<table><thead><tr><th>配置项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>exports</code></td><td>导出的函数（可重命名）</td><td><code>["add", "foo:bar"]</code></td></tr><tr><td><code>export-memory-name</code></td><td>导出的内存名称</td><td><code>"memory"</code></td></tr><tr><td><code>heap-start-address</code></td><td>堆起始地址</td><td><code>1024</code></td></tr><tr><td><code>import-memory</code></td><td>从宿主环境导入的内存配置</td><td><code>&#123;"module": "env", "name": "memory"&#125;</code></td></tr></tbody></table>
<p><strong>函数重命名</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"add"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 导出为 add</span>
        <span class="hljs-string">"multiply:mul"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// MoonBit 中的 multiply 导出为 mul</span>
        <span class="hljs-string">"divide:math_div"</span> <span class="hljs-comment">// MoonBit 中的 divide 导出为 math_div</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：嵌入到 Web 应用</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"process_image"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"apply_filter"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"export-memory-name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>在 JavaScript 中调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> wasmModule = <span class="hljs-keyword">await</span> <span class="hljs-title class_">WebAssembly</span>.<span class="hljs-title function_">instantiateStreaming</span>(<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'image_processor.wasm'</span>));

<p><span class="hljs-keyword">const</span> result &#x3D; wasmModule.<span class="hljs-property">instance</span>.<span class="hljs-property">exports</span>.<span class="hljs-title function_">process_image</span>(imageData);<br></p></code></pre><p></p>
<p><strong>场景二：共享内存场景</strong></p>
<p>当需要与宿主环境共享内存时：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"calculate"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"import-memory"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
                <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"env"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span>
            <span class="hljs-punctuation">&#125;</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<h4 data-id="heading-12">wasm-gc 链接配置</h4>
<p>用于配置编译为带垃圾回收的 WebAssembly。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm-gc"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"process"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"transform"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"use-js-builtin-string"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"imported-string-constants"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>配置项说明</strong>：</p>
<table><thead><tr><th>配置项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>exports</code></td><td>导出的函数列表</td><td><code>["add"]</code></td></tr><tr><td><code>use-js-builtin-string</code></td><td>使用 JavaScript 原生字符串</td><td><code>true</code></td></tr><tr><td><code>imported-string-constants</code></td><td>字符串常量导入命名空间</td><td><code>"_"</code></td></tr></tbody></table>
<p><strong>use-js-builtin-string 说明</strong>：</p>
<table><thead><tr><th>设置</th><th>字符串处理方式</th><th>性能</th><th>兼容性</th></tr></thead><tbody><tr><td><code>true</code></td><td>使用 JS 原生字符串（推荐）</td><td>更快</td><td>需要新浏览器</td></tr><tr><td><code>false</code></td><td>使用 Wasm 内部字符串表示</td><td>较慢</td><td>更好的兼容性</td></tr></tbody></table>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：现代 Web 应用</strong></p>
<p>利用最新的 Wasm-GC 特性：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm-gc"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"render"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"update"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"use-js-builtin-string"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"imported-string-constants"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"strings"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>场景二：高性能字符串处理</strong></p>
<p>大量字符串操作时，使用 JS 字符串可以显著提升性能：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm-gc"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"parse_json"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"stringify"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"use-js-builtin-string"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<h4 data-id="heading-13">多目标配置</h4>
<p>可以同时配置多个目标：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gcc"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-lm"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"calculate"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esm"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"calculate"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm-gc"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"calculate"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"use-js-builtin-string"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>编译目标选择建议</strong>：</p>
<table><thead><tr><th>目标</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><code>native</code></td><td>命令行工具、系统程序</td><td>最快、无运行时依赖</td><td>平台相关</td></tr><tr><td><code>js</code></td><td>Node.js 服务、前端应用</td><td>生态丰富、易于调试</td><td>性能较低</td></tr><tr><td><code>wasm</code></td><td>浏览器应用、跨平台</td><td>跨平台、性能好</td><td>调试相对困难</td></tr><tr><td><code>wasm-gc</code></td><td>现代浏览器、复杂应用</td><td>性能最佳、内存管理好</td><td>浏览器兼容性要求高</td></tr></tbody></table>
<h3 data-id="heading-14">native-stub 配置说明</h3>
<p><code>native-stub</code> 用于指定 C 语言的"桩文件"（stub files）。就像给 MoonBit 提供一些 C 语言的"帮手"。</p>
<p><strong>什么是 Stub 文件？</strong></p>
<p>当你需要在 MoonBit 中调用 C 语言的功能时（比如操作系统 API、第三方 C 库），就需要编写一些 C 代码作为"桥梁"，这些 C 代码文件就叫 stub 文件。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"native-stub"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ffi_helpers.c"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"system_calls.c"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：调用系统 API</strong></p>
<p>需要调用 POSIX 系统调用：</p>
<p><strong>ffi_helpers.c</strong>：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<p><span class="hljs-comment">&#x2F;&#x2F; 提供给 MoonBit 调用的 C 函数</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">get_process_id</span><span class="hljs-params">()</span> &amp;#123;<br>    <span class="hljs-keyword">return</span> getpid();<br>&amp;#125;</p>
<p><span class="hljs-type">void</span> <span class="hljs-title function_">print_message</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* msg)</span> &amp;#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">“%s\n”</span>, msg);<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"native-stub"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ffi_helpers.c"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gcc"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>MoonBit 代码</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 声明外部 C 函数
extern "C" fn get_process_id() -&gt; Int
extern "C" fn print_message(msg: String) -&gt; Unit

<p>fn main &amp;#123;<br>  let pid &#x3D; get_process_id()<br>  println(“Process ID: &amp;#123;pid&amp;#125;”)<br>  print_message(“Hello from C!”)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景二：调用第三方 C 库</strong></p>
<p>使用 SQLite 数据库：</p>
<p><strong>sqlite_wrapper.c</strong>：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sqlite3.h&gt;</span></span>

<p><span class="hljs-comment">&#x2F;&#x2F; 包装 SQLite 函数供 MoonBit 使用</span><br>sqlite3* <span class="hljs-title function_">open_database</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename)</span> &amp;#123;<br>    sqlite3* db;<br>    sqlite3_open(filename, &amp;db);<br>    <span class="hljs-keyword">return</span> db;<br>&amp;#125;</p>
<p><span class="hljs-type">void</span> <span class="hljs-title function_">close_database</span><span class="hljs-params">(sqlite3* db)</span> &amp;#123;<br>    sqlite3_close(db);<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"native-stub"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"sqlite_wrapper.c"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"link"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"native"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"cc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gcc"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cc-link-flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-lsqlite3"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<p>⚠️ stub 文件只在编译到 native 目标时有效</p>
<p>⚠️ 需要确保 C 编译器能找到相关的头文件和库文件</p>
<p>⚠️ 使用第三方 C 库时，需要在 <code>cc-link-flags</code> 中添加相应的链接选项</p>
<p><strong>Stub 文件的作用</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">MoonBit 代码
    ↓ (调用)
extern 声明
    ↓ (通过)
Stub C 文件 ←→ 系统 API / 第三方 C 库
    ↓ (返回)
MoonBit 代码
</code></pre>
<h3 data-id="heading-15">implement 和 overrides 配置说明</h3>
<p>这两个配置与 MoonBit 的<code>虚拟包(Virtual Package)</code>机制相关，用于实现接口和覆盖默认实现。</p>
<h4 data-id="heading-16">什么是虚拟包？</h4>
<p>虚拟包就像是一个"合同"或"接口规范"，定义了一组函数签名，但不提供具体实现。不同的包可以提供不同的实现。</p>
<p><strong>类比理解</strong>：</p>
<ul>
<li><strong>虚拟包</strong>：像电源插座标准（220V、两孔、三孔等）</li>
<li><strong>实现包</strong>：像具体的电器插头（手机充电器、笔记本充电器等）</li>
<li><strong>好处</strong>：只要遵循标准，任何电器都能用</li>
</ul>
<h4 data-id="heading-17">implement 配置</h4>
<p><code>implement</code> 用于声明当前包实现了某个虚拟包。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/abort"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p><strong>场景一：实现日志接口</strong></p>
<p><strong>虚拟包定义</strong>（<code>logger.mbti</code>）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// moonbitlang/core/logger 的接口定义
pub fn log(level: String, message: String) -&gt; Unit
pub fn error(message: String) -&gt; Unit
pub fn info(message: String) -&gt; Unit
</code></pre>
<p><strong>实现包 1</strong>：控制台日志</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/logger"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// console_logger/top.mbt
pub fn log(level: String, message: String) -&gt; Unit &#123;
  println("[\&#123;level&#125;] \&#123;message&#125;")
&#125;

<p>pub fn error(message: String) -&gt; Unit &amp;#123;<br>  log(“ERROR”, message)<br>&amp;#125;</p>
<p>pub fn info(message: String) -&gt; Unit &amp;#123;<br>  log(“INFO”, message)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>实现包 2</strong>：文件日志</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/logger"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// file_logger/top.mbt
pub fn log(level: String, message: String) -&gt; Unit &#123;
  // 写入文件
  write_to_file("app.log", "[\&#123;level&#125;] \&#123;message&#125;")
&#125;

<p>pub fn error(message: String) -&gt; Unit &amp;#123;<br>  log(“ERROR”, message)<br>&amp;#125;</p>
<p>pub fn info(message: String) -&gt; Unit &amp;#123;<br>  log(“INFO”, message)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景二：跨平台适配</strong></p>
<p>为不同平台提供不同实现：</p>
<p><strong>虚拟包</strong>（<code>moonbitlang/core/os</code>）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn get_env(name: String) -&gt; Option[String]
pub fn set_env(name: String, value: String) -&gt; Unit
</code></pre>
<p><strong>Windows 实现</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/os"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// os_windows/top.mbt
pub fn get_env(name: String) -&gt; Option[String] &#123;
  // Windows 特定实现
  windows_get_env(name)
&#125;
</code></pre>
<p><strong>Linux 实现</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/os"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">// os_linux/top.mbt
pub fn get_env(name: String) -&gt; Option[String] &#123;
  // Linux 特定实现
  linux_get_env(name)
&#125;
</code></pre>
<h4 data-id="heading-18">overrides 配置</h4>
<p><code>overrides</code> 用于覆盖虚拟包的默认实现，选择使用特定的实现。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"myproject/custom_logger/console"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用场景</strong>：</p>
<p><strong>场景：切换日志实现</strong></p>
<p>项目默认使用简单的控制台日志，生产环境需要切换到文件日志：</p>
<p><strong>开发环境配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"moonbitlang/core/logger"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"myproject/logger/console"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>生产环境配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"moonbitlang/core/logger"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"myproject/logger/file"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>应用代码保持不变</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main &#123;
  // 使用统一的接口，具体实现由配置决定
  @logger.info("Application started")
  @logger.error("An error occurred")
&#125;
</code></pre>
<h4 data-id="heading-19">virtual 配置</h4>
<p><code>virtual</code> 用于声明当前包是一个虚拟包。</p>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"virtual"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"has-default"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>has-default 说明</strong>：</p>
<table><thead><tr><th>值</th><th>含义</th><th>使用场景</th></tr></thead><tbody><tr><td><code>true</code></td><td>虚拟包提供默认实现</td><td>大多数情况下可以直接使用</td></tr><tr><td><code>false</code></td><td>必须由其他包提供实现</td><td>强制用户选择特定实现</td></tr></tbody></table>
<p><strong>完整示例</strong>：</p>
<p><strong>1. 定义虚拟包</strong>（<code>storage.mbti</code>）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// moonbitlang/core/storage
pub fn save(key: String, value: String) -&gt; Unit
pub fn load(key: String) -&gt; Option[String]
pub fn delete(key: String) -&gt; Unit
</code></pre>
<p><strong>2. 虚拟包配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"virtual"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"has-default"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>3. 提供默认实现</strong>（<code>storage/top.mbt</code>）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 简单的内存存储作为默认实现
let storage: Map[String, String] = Map::new()

<p>pub fn save(key: String, value: String) -&gt; Unit &amp;#123;<br>  storage.set(key, value)<br>&amp;#125;</p>
<p>pub fn load(key: String) -&gt; Option[String] &amp;#123;<br>  storage.get(key)<br>&amp;#125;</p>
<p>pub fn delete(key: String) -&gt; Unit &amp;#123;<br>  storage.remove(key)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>4. 提供 Redis 实现</strong>（<code>storage_redis/top.mbt</code>）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"implement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moonbitlang/core/storage"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn save(key: String, value: String) -&gt; Unit &#123;
  redis_set(key, value)
&#125;

<p>pub fn load(key: String) -&gt; Option[String] &amp;#123;<br>  redis_get(key)<br>&amp;#125;</p>
<p>pub fn delete(key: String) -&gt; Unit &amp;#123;<br>  redis_del(key)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>5. 使用存储</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 使用默认实现（内存存储）
fn use_default_storage &#123;
  @storage.save("name", "Alice")
  let value = @storage.load("name")
&#125;

<p>&#x2F;&#x2F; 或者在配置中覆盖为 Redis 实现<br>&#x2F;&#x2F; moon.pkg.json:<br>&#x2F;&#x2F; &amp;#123;<br>&#x2F;&#x2F;   “overrides”: [“myproject&#x2F;storage_redis”]<br>&#x2F;&#x2F; &amp;#125;<br></p></code></pre><p></p>
<p><strong>虚拟包机制的优势</strong>：</p>
<table><thead><tr><th>优势</th><th>说明</th><th>举例</th></tr></thead><tbody><tr><td>解耦</td><td>接口和实现分离</td><td>日志、存储、网络请求等</td></tr><tr><td>可替换</td><td>轻松切换不同实现</td><td>开发环境用 Mock，生产用真实 API</td></tr><tr><td>可测试</td><td>测试时使用测试专用实现</td><td>使用内存数据库代替真实数据库</td></tr><tr><td>跨平台</td><td>为不同平台提供特定实现</td><td>Windows/Linux/macOS 特定功能</td></tr><tr><td>渐进式开发</td><td>先用简单实现，后续优化</td><td>先用内存缓存，后续加 Redis</td></tr></tbody></table>
<h3 data-id="heading-20">pre-build 配置说明</h3>
<p><code>pre-build</code> 用于在正式编译前执行一些预处理任务。就像做饭前的备菜工作。</p>
<p><strong>配置格式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"data.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"data.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>配置项说明</strong>：</p>
<table><thead><tr><th>字段</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>input</code></td><td>输入文件路径</td><td><code>"config.txt"</code>, <code>"template.html"</code></td></tr><tr><td><code>output</code></td><td>输出的 MoonBit 文件</td><td><code>"config.mbt"</code>, <code>"template.mbt"</code></td></tr><tr><td><code>command</code></td><td>执行的命令</td><td><code>":embed -i $input -o $output"</code></td></tr></tbody></table>
<h4 data-id="heading-21">内置命令：:embed</h4>
<p><code>:embed</code> 命令可以将文本文件嵌入到 MoonBit 代码中。</p>
<p><strong>基本用法</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"readme.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"readme.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>输入文件</strong>（<code>readme.txt</code>）：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Welcome <span class="hljs-keyword">to</span> MoonBit!
This <span class="hljs-built_in">is</span> a sample <span class="hljs-keyword">text</span> file.
</code></pre>
<p><strong>生成的代码</strong>（<code>readme.mbt</code>）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let resource : String =
  #|Welcome to MoonBit!
  #|This is a sample text file.
  #|
</code></pre>
<h4 data-id="heading-22">使用场景</h4>
<p><strong>场景一：嵌入配置文件</strong></p>
<p>将 JSON 配置文件嵌入到代码中：</p>
<p><strong>config.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"api_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.example.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"timeout"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5000</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"retry"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"config.json"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"config_data.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用生成的配置</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 引用生成的 config_data.mbt
fn get_config() -&gt; String &#123;
  // resource 变量由 :embed 命令自动生成
  resource
&#125;

<p>fn main &amp;#123;<br>  let config_str &#x3D; get_config()<br>  &#x2F;&#x2F; 解析 JSON 配置并使用<br>  let config &#x3D; parse_json(config_str)<br>  println(“API URL: &amp;#123;config.api_url&amp;#125;”)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景二：嵌入 HTML 模板</strong></p>
<p>Web 应用中嵌入 HTML 模板：</p>
<p><strong>template.html</strong>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123;heading&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123;content&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"template.html"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"template.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>使用模板</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn render_page(title: String, heading: String, content: String) -&gt; String &#123;
  // resource 是嵌入的 HTML 模板
  let html = resource
    .replace("&#123;&#123;title&#125;&#125;", title)
    .replace("&#123;&#123;heading&#125;&#125;", heading)
    .replace("&#123;&#123;content&#125;&#125;", content)
  html
&#125;

<p>fn main &amp;#123;<br>  let page &#x3D; render_page(“Home”, “Welcome”, “This is the home page”)<br>  println(page)<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景三：嵌入多个资源文件</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"help.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"help_text.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"version.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"version_info.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"license.txt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"license_text.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>场景四：嵌入 SQL 查询</strong></p>
<p>数据库应用中嵌入 SQL 语句：</p>
<p><strong>queries.sql</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">18</span>;
<span class="hljs-keyword">SELECT</span> name, email <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span>;
</code></pre>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"queries.sql"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"queries.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>自定义变量名</strong>：</p>
<p>默认生成的变量名是 <code>resource</code>，可以通过 <code>--name</code> 参数自定义：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"pre-build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">&#123;</span>
            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"config.json"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"config.mbt"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">":embed -i $input -o $output --name app_config"</span>
        <span class="hljs-punctuation">&#125;</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>生成的代码：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let app_config : String =
  #|&#123;"api_url": "https://api.example.com"&#125;
</code></pre>
<p><strong>pre-build 的优势</strong>：</p>
<table><thead><tr><th>优势</th><th>说明</th><th>举例</th></tr></thead><tbody><tr><td>类型安全</td><td>文件内容编译时即可用，避免运行时读取</td><td>无需处理文件不存在错误</td></tr><tr><td>性能更好</td><td>无需运行时 I/O 操作</td><td>直接使用字符串常量</td></tr><tr><td>部署简单</td><td>资源打包进二进制，无需额外文件</td><td>单文件部署，不丢失资源</td></tr><tr><td>版本一致</td><td>资源和代码版本绑定</td><td>避免资源文件版本不匹配</td></tr></tbody></table>
<p><strong>注意事项</strong>：</p>
<p>⚠️ <code>input</code> 路径相对于包目录</p>
<p>⚠️ <code>output</code> 文件会自动生成，不要手动编辑</p>
<p>⚠️ 适合嵌入小型文本文件，大文件建议运行时加载</p>
<p>⚠️ 每次修改输入文件后需要重新编译</p>
<h3 data-id="heading-23">targets 配置说明</h3>
<p><code>targets</code> 用于条件编译，让特定的文件只在特定条件下编译。就像根据天气选择不同的衣服。</p>
<p><strong>配置格式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"filename.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"条件"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<h4 data-id="heading-24">基本条件</h4>
<p><strong>按编译目标</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"only_js.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_wasm_gc.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_native.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"native"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>按优化级别</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"only_debug.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"only_release.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<h4 data-id="heading-25">组合条件</h4>
<p><strong>多个条件（OR 关系）</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"all_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"js_or_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>意思是：<code>all_wasm.mbt</code> 在编译到 <code>wasm</code> <strong>或</strong> <code>wasm-gc</code> 时都会被包含。</p>
<p><strong>AND 逻辑</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"js_and_release.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>意思是：只有在编译到 <code>js</code> <strong>且</strong> 是 <code>release</code> 模式时才包含。</p>
<p><strong>OR 逻辑</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"wasm_release_or_js_debug.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"or"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"js"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>意思是：在 <code>(wasm + release)</code> 或 <code>(js + debug)</code> 时包含。</p>
<p><strong>NOT 逻辑</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"not_js.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"not"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p>意思是：除了 <code>js</code> 目标，其他目标都包含这个文件。</p>
<h4 data-id="heading-26">使用场景</h4>
<p><strong>场景一：平台特定代码</strong></p>
<p>为不同平台提供不同实现：</p>
<p><strong>项目结构</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">src/
  ├── common.mbt          <span class="hljs-comment"># 通用代码</span>
  ├── js_api.mbt          <span class="hljs-comment"># JavaScript 专用</span>
  ├── wasm_api.mbt        <span class="hljs-comment"># WebAssembly 专用</span>
  └── native_api.mbt      <span class="hljs-comment"># 原生平台专用</span>
</code></pre>
<p><strong>moon.pkg.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"js_api.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"wasm_api.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"native_api.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"native"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>js_api.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 只在编译到 JS 时使用
pub fn fetch_data(url: String) -&gt; String &#123;
  // 使用 fetch API
  js_fetch(url)
&#125;
</code></pre>
<p><strong>wasm_api.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 只在编译到 Wasm 时使用
pub fn fetch_data(url: String) -&gt; String &#123;
  // 使用 Wasm 的方式
  wasm_http_get(url)
&#125;
</code></pre>
<p><strong>native_api.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 只在编译到 Native 时使用
pub fn fetch_data(url: String) -&gt; String &#123;
  // 使用系统 API
  native_http_request(url)
&#125;
</code></pre>
<p><strong>common.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 所有平台共用
fn main &#123;
  let data = fetch_data("https://api.example.com")
  println(data)
&#125;
</code></pre>
<p><strong>场景二：调试和生产环境</strong></p>
<p>开发时包含调试代码，发布时自动排除：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"debug_utils.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"production_config.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>debug_utils.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn log_debug(message: String) -&gt; Unit &#123;
  println("[DEBUG] \&#123;message&#125;")
&#125;

<p>pub fn assert_valid(value: Int) -&gt; Unit &amp;#123;<br>  if value &lt; 0 &amp;#123;<br>    panic(“Invalid value: &amp;#123;value&amp;#125;”)<br>  &amp;#125;<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>production_config.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn log_debug(message: String) -&gt; Unit &#123;
  // 生产环境不输出调试信息
&#125;

<p>pub fn assert_valid(value: Int) -&gt; Unit &amp;#123;<br>  &#x2F;&#x2F; 生产环境跳过验证，提升性能<br>&amp;#125;<br></p></code></pre><p></p>
<p><strong>场景三：特性开关</strong></p>
<p>根据编译配置启用不同功能：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"feature_experimental.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"debug"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"feature_stable.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>feature_experimental.mbt</strong>（实验性功能）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn new_algorithm(data: Array[Int]) -&gt; Int &#123;
  // 新的、未充分测试的算法
  experimental_sort(data)
&#125;
</code></pre>
<p><strong>feature_stable.mbt</strong>（稳定功能）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">pub fn new_algorithm(data: Array[Int]) -&gt; Int &#123;
  // 经过验证的稳定算法
  stable_sort(data)
&#125;
</code></pre>
<p><strong>场景四：性能优化</strong></p>
<p>针对不同目标提供优化版本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"optimized_wasm.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"generic.mbt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"not"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"and"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"wasm-gc"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"release"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>optimized_wasm.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// Wasm-GC 发布版的高度优化版本
pub fn process_large_array(arr: Array[Int]) -&gt; Int &#123;
  // 使用 SIMD 等 Wasm 特性
  wasm_simd_process(arr)
&#125;
</code></pre>
<p><strong>generic.mbt</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">// 通用版本
pub fn process_large_array(arr: Array[Int]) -&gt; Int &#123;
  // 标准实现
  arr.fold_left(fn(acc, x) &#123; acc + x &#125;, 0)
&#125;
</code></pre>
<h4 data-id="heading-27">条件编译对比表</h4>
<table><thead><tr><th>方法</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><code>targets</code> 文件级别</td><td>清晰，易于管理</td><td>粒度较粗</td><td>平台特定模块</td></tr><tr><td><code>#[cfg]</code> 函数级别</td><td>粒度细，灵活</td><td>代码可能显得凌乱</td><td>个别函数的平台差异</td></tr><tr><td>虚拟包</td><td>完全解耦，可替换</td><td>需要额外配置</td><td>大型跨平台项目</td></tr></tbody></table>
<p><strong>最佳实践</strong>：</p>
<ol>
<li><strong>优先使用 <code>targets</code></strong>：大块平台特定代码放在单独文件中</li>
<li><strong>补充使用 <code>#[cfg]</code></strong>：少量平台差异在函数级别处理</li>
<li><strong>保持一致性</strong>：同一项目使用统一的条件编译策略</li>
<li><strong>文档说明</strong>：在 README 中说明哪些文件是条件编译的</li>
</ol>
<h3 data-id="heading-28">virtual 配置说明</h3>
<p>前面在 <code>implement</code> 和 <code>overrides</code> 部分已经详细介绍过，这里简要总结。</p>
<p><code>virtual</code> 用于声明当前包是一个虚拟包（接口包）。</p>
<p><strong>配置格式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"virtual"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
        <span class="hljs-attr">"has-default"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<p><strong>has-default 说明</strong>：</p>
<table><thead><tr><th>值</th><th>含义</th><th>适用场景</th></tr></thead><tbody><tr><td><code>true</code></td><td>虚拟包提供默认实现</td><td>提供开箱即用的实现</td></tr><tr><td><code>false</code></td><td>必须由其他包提供实现</td><td>强制用户选择实现</td></tr></tbody></table>
<p><strong>典型用途</strong>：</p>
<ul>
<li>定义抽象接口（如日志、存储、网络）</li>
<li>提供可替换的实现</li>
<li>支持跨平台开发</li>
</ul>
<p>详细内容请参考前面的 <code>implement 和 overrides 配置说明</code> 章节。</p>
<h3 data-id="heading-29">warn-list 和 alert-list 配置说明</h3>
<p>这两个配置用于控制编译器的警告和提示信息。在上篇文章的模块配置中已经详细介绍过，包配置中的用法完全一致。</p>
<h4 data-id="heading-30">warn-list 简要回顾</h4>
<p>控制编译器预设的警告：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"warn-list"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-2-4+31"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<ul>
<li><code>-2</code>：关闭"未使用变量"警告</li>
<li><code>-4</code>：关闭"未使用抽象类型"警告</li>
<li><code>+31</code>：开启"未使用可选参数"警告</li>
</ul>
<h4 data-id="heading-31">alert-list 简要回顾</h4>
<p>控制自定义的警告：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"alert-list"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-deprecated+unsafe"</span>
<span class="hljs-punctuation">&#125;</span>
</code></pre>
<ul>
<li><code>-deprecated</code>：关闭"废弃"警告</li>
<li><code>+unsafe</code>：开启"不安全"警告</li>
</ul>
<p><strong>配置级别优先级</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">包级别配置 (moon.pkg.json) &gt; 模块级别配置 (moon.mod.json)
</code></pre>
<p>如果在包配置中设置了 <code>warn-list</code>，会覆盖模块配置中的设置。</p>
<p><strong>使用建议</strong>：</p>
<ul>
<li><strong>模块级别</strong>：设置项目整体的警告策略</li>
<li><strong>包级别</strong>：针对特殊包调整警告（如测试包、第三方适配包）</li>
</ul>
<p>详细内容请参考上篇文章的 <code>warn-list 配置说明</code> 和 <code>alert-list 配置说明</code> 章节。</p>
<h3 data-id="heading-32">总结</h3>
<p>本文详细介绍了 MoonBit 的包配置文件 <code>moon.pkg.json</code> 的各个配置项：</p>
<p><strong>核心配置</strong>：</p>
<ul>
<li><code>is-main</code>：标识入口包</li>
<li><code>import</code>：导入依赖包</li>
<li><code>test-import</code> 和 <code>wbtest-import</code>：测试专用导入</li>
</ul>
<p><strong>编译链接</strong>：</p>
<ul>
<li><code>link</code>：多目标编译配置（native, js, wasm, wasm-gc）</li>
<li><code>native-stub</code>：C 语言桥接文件</li>
<li><code>targets</code>：条件编译配置</li>
</ul>
<p><strong>高级特性</strong>：</p>
<ul>
<li><code>implement</code> 和 <code>overrides</code>：虚拟包机制</li>
<li><code>virtual</code>：定义虚拟包</li>
<li><code>pre-build</code>：预编译处理</li>
</ul>
<p><strong>代码质量</strong>：</p>
<ul>
<li><code>warn-list</code>：控制编译警告</li>
<li><code>alert-list</code>：控制自定义提示</li>
</ul>
<p>通过合理配置这些选项，你可以：</p>
<p>✅ 构建跨平台应用</p>
<p>✅ 优化编译产物</p>
<p>✅ 实现模块化架构</p>
<p>✅ 提升开发体验</p>
<p>✅ 保证代码质量</p>
<p>下一篇文章将开始介绍 MoonBit 如何在前端开发中用起来，敬请期待！</p>

</div>

<div>
<div class="tag-plugin link dis-select"><a class="link-card plain" title="改变世界的编程语言MoonBit：配置系统介绍(下)" href="https://juejin.cn/post/7567188622846656562" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">改变世界的编程语言MoonBit：配置系统介绍(下)</span><span class="desc fs12">https://juejin.cn/post/7567188622846656562</span></div><div class="right"><div class="lazy img" data-bg="https://static.mhuig.top/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div>
</div>



<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-CN">GLWT（Good Luck With That，祝你好运）公共许可证</a> 许可协议。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="header cap theme"><span>接下来阅读</span></section><section class="body fs14"><a id="next" href="/rss/78772d83.html">配置文件面面观（上）：配置格式的类型和特点<span class="note">较早</span></a><div class="line"></div><a id="prev" href="/rss/9ffd9040.html">BGP Zombies and Excessive Path Hunting<span class="note">较新</span></a></section></div>


<div class="related-wrap reveal" id="related-posts">
    <section class="header">
      <div class="title cap theme">您可能感兴趣的文章</div>
    </section>
    <section class="body">
    <div class="related-posts"><a class="item" href="/rss/94ebdae8.html" title="AI产品发展必经之路： 从售卖工具到售卖解决方案"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3075c572d5cc4f84960e8cfbc7584378~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5rSb:q75.awebp?rk3s=f64ab15b&x-expires=1762410050&x-signature=yehyzPbxYZn8kN1pMUld8gAahKw%3D"></div><span class="title">AI产品发展必经之路： 从售卖工具到售卖解决方案</span></a><a class="item" href="/rss/f98299b5.html" title="Python编程实战：日期处理与数学算法综合练习"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=9464"></div><span class="title">Python编程实战：日期处理与数学算法综合练习</span></a><a class="item" href="/rss/27abc8d1.html" title="K8s Service会话保持导致Pod流量不均：故障排查与深度解析"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=5301"></div><span class="title">K8s Service会话保持导致Pod流量不均：故障排查与深度解析</span></a><a class="item" href="/rss/f560986c.html" title="iOS基础问题整理"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=2466"></div><span class="title">iOS基础问题整理</span></a><a class="item" href="/rss/30942235.html" title="RIVAL：面向机器翻译的迭代对抗强化学习"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7472fc7f373d40ca931c42a2bb217027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&x-expires=1762488137&x-signature=uKIdVTbYaU6gkSIWY6b9VMdh6LE%3D"></div><span class="title">RIVAL：面向机器翻译的迭代对抗强化学习</span></a><a class="item" href="/rss/f3aae144.html" title="一网打尽：手把手教你搭建PXE网络启动服务器"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=9901"></div><span class="title">一网打尽：手把手教你搭建PXE网络启动服务器</span></a><a class="item" href="/rss/8fd20786.html" title="上传项目至GitHub与从Github克隆项目"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=3707"></div><span class="title">上传项目至GitHub与从Github克隆项目</span></a><a class="item" href="/rss/c4e8ca55.html" title="告别Div地狱：现代HTML的语义化编程革命"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=2628"></div><span class="title">告别Div地狱：现代HTML的语义化编程革命</span></a><a class="item" href="/rss/1cd95816.html" title="大语言模型是如何听懂并会说人话的"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f73f48697a264e9b9fd715ddb4860435~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiO5byA5Y-R5ZCM6KGM:q75.awebp?rk3s=f64ab15b&x-expires=1762511211&x-signature=GH1pwXffHHALfU6MC07XPmtF9oA%3D"></div><span class="title">大语言模型是如何听懂并会说人话的</span></a><a class="item" href="/rss/499ddaa8.html" title="对 GPT 5 模型路由机制的深度解析"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b22ce078a1ea437dad51cfba2933d500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&x-expires=1762478701&x-signature=RvWI8QrUl%2FXHJUCZUvf3jEHgXnU%3D"></div><span class="title">对 GPT 5 模型路由机制的深度解析</span></a><a class="item" href="/rss/d2fd7096.html" title="学而时习之：C++中的函数"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8c65c77d9a42efbc81d077a031e7ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&x-expires=1762398184&x-signature=SDsJe%2FKsJyTaLwHVo0c45QezbLM%3D"></div><span class="title">学而时习之：C++中的函数</span></a><a class="item" href="/rss/65d5b4e1.html" title="现代JavaScript字符串处理：从基础语法到模板字符串的深度演进与技术实践"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=9701"></div><span class="title">现代JavaScript字符串处理：从基础语法到模板字符串的深度演进与技术实践</span></a><a class="item" href="/rss/a4dd8675.html" title="翻译：苹果那传奇般的细节关注去哪儿了？"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cors.mhuig.top/?r=https://juejin.cn&url=https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04906cb5825f40d49bb8be1d09af2721~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVjaGVjYXI=:q75.awebp?rk3s=f64ab15b&x-expires=1762481178&x-signature=Uk%2F6x%2FkQ47E1xnyhXluU8G1HKE4%3D"></div><span class="title">翻译：苹果那传奇般的细节关注去哪儿了？</span></a></div></section></div>





      
<footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">RSS</span><a href="/">近期</a><a href="/categories/">分类</a><a href="/tags/">标签</a><a href="/archives/">归档</a></div><div class="sitemap-group"><span class="fs14">Support</span><a target="_blank" rel="noopener" href="https://blog.mhuig.top/">博客</a><a target="_blank" rel="noopener" href="https://api.mhuig.top/">API</a><a target="_blank" rel="noopener" href="https://ssl.mhuig.top/">SSL Status</a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://mhuig.instatus.com/">Status Monitors</a></div><div class="sitemap-group"><span class="fs14">社交</span><a target="_blank" rel="noopener" href="https://blog.mhuig.top/pages/friends/">友链</a><a target="_blank" rel="noopener" href="https://blog.mhuig.top/pages/about/">留言板</a></div><div class="sitemap-group"><span class="fs14">更多</span><a target="_blank" rel="noopener" href="https://mhuig.top/">关于我</a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/MHuiG">GitHub</a><a href="/contact/">Contact</a><a href="/privacy-policy/">隐私政策</a></div></div><div class="text"><p>本站由 <a target="_blank" rel="noopener" href="https://mhuig.top/">MHuiG</a> 使用 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建，您可以在 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/MHG-LAB/RSSBOX">GitHub</a> 找到本站源码<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-CN">GLWT（Good Luck With That，祝你好运）公共许可证</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class="float-panel mobile-only blur" style="display:none">
  <button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()">
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"/><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"/></svg>
  </button>
</div>

    </div>
  </div>
  <div class="scripts">
    <script type="text/javascript">
  stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.9.0';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://static.mhuig.top/npm/jquery@3.5.1/dist/jquery.min.js',
    sitesjs: '/js/plugins/sites.js',
    friendsjs: '/js/plugins/friends.js',
  };

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://static.mhuig.top/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@6/swiper-bundle.min.css","js":"https://unpkg.com/swiper@6/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://static.mhuig.top/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://static.mhuig.top/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://static.mhuig.top/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://static.mhuig.top/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://static.mhuig.top/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img,article.content img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti/umd/heti.min.css","js":"https://unpkg.com/heti/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
